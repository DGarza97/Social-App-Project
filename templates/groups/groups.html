{% load static %}
<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>Groups | Social App</title>
    <link rel="stylesheet" href="{% static 'css/groups.css' %}">
</head>

<body>

    <!-- PROFILE -->
    <div class="profile-wrapper">
        <img class="profile-icon"
            src="https://ui-avatars.com/api/?name={{ request.user.username }}&background=111827&color=ffffff"
            id="profileToggle">
        <div class="profile-dropdown" id="profileDropdown">
            <a href="{% url 'profile' %}">Profile</a>
            <form method="post" action="{% url 'logout' %}">
                {% csrf_token %}
                <button class="logout-btn">Sign Out</button>
            </form>
        </div>
    </div>

    <!-- SIDEBAR -->
    <div class="sidebar">
        <a href="{% url 'feed' %}">Home</a>
        <a href="{% url 'my_projects' %}">My Projects</a>
        <a href="{% url 'groups' %}" class="active">Groups</a>
        <a href="{% url 'messages' %}">Messages</a>
    </div>

    <!-- GROUPS PAGE -->
    <div class="groups-page">

        <!-- CREATE GROUP -->
        <div class="create-group">
            <h2>Create a Group</h2>
            <form method="post">
                {% csrf_token %}
                <input type="text" name="name" placeholder="Group name" required>
                <textarea name="description" placeholder="What is this group about?" required></textarea>
                <button type="submit">Create Group</button>
            </form>
        </div>

        <!-- AVAILABLE GROUPS -->
        <div class="group-list">
            <h2>Available Groups</h2>

            {% for group in groups %}
            <div class="group-card">
                <h3>{{ group.name }}</h3>
                <p>{{ group.description }}</p>

                <!-- MEMBERS -->
                <div class="group-members">
                    <span class="members-label">Members:</span>

                    {% for member in group.members.all %}
                    <span class="member">
                        {{ member.username }}
                    </span>
                    {% empty %}
                    <span class="no-members">No members yet</span>
                    {% endfor %}
                </div>

                {% if request.user in group.members.all %}
                <span class="joined">Joined</span>
                {% else %}
                <form method="post" action="{% url 'join_group' group.id %}">
                    {% csrf_token %}
                    <button>Join Group</button>
                </form>
                {% endif %}
            </div>

            {% empty %}
            <p>No groups available.</p>
            {% endfor %}
        </div>

    </div>

    <script>
        const profileToggle = document.getElementById("profileToggle");
        const profileDropdown = document.getElementById("profileDropdown");

        profileToggle.addEventListener("click", e => {
            e.stopPropagation();
            profileDropdown.classList.toggle("show");
        });

        document.addEventListener("click", () => {
            profileDropdown.classList.remove("show");
        });
    </script>

</body>

</html>
